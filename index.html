<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B600%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />
    <title>FBA Shipment Cost Estimator</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
        #resultsPane {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
        }
        #resultsPane.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .result-item p.range { font-size: 1.25rem; }
    </style>
</head>
<body>
    <div class="relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
        <div id="app-container" class="layout-container flex h-full grow flex-col" style="display:none;">
            <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#e7edf4] px-10 py-3">
                <div class="flex items-center gap-4 text-[#0d141c]">
                    <div class="size-4">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_6_330)"><path fill-rule="evenodd" clip-rule="evenodd" d="M24 0.757355L47.2426 24L24 47.2426L0.757355 24L24 0.757355ZM21 35.7574V12.2426L9.24264 24L21 35.7574Z" fill="currentColor"></path></g><defs><clipPath id="clip0_6_330"><rect width="48" height="48" fill="white"></rect></clipPath></defs></svg>
                    </div>
                    <h2 class="text-[#0d141c] text-lg font-bold leading-tight tracking-[-0.015em]">Shipment Estimator</h2>
                </div>
            </header>

            <div id="welcomePage" class="px-10 md:px-40 flex flex-1 justify-center py-5">
                 <div class="layout-content-container flex flex-col w-full max-w-[960px] flex-1">
                    <div class="text-center">
                        <h1 class="text-4xl font-bold text-[#004d99]">FBA Shipment Cost Estimator</h1>
                        <p class="text-lg text-slate-600 mt-2">(Excludes Last Mile Rates)</p>
                    </div>
                    <div class="instructions text-left my-10">
                        <h3 class="text-xl font-bold text-[#004d99] border-b-2 border-[#0d80f2] pb-2 mb-4">Key Amazon FBA Shipment Guidelines</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                            <div class="bg-white p-4 rounded-lg border border-slate-200"><p class="text-[#0d141c] text-base font-medium">Carton Limits</p><p class="text-slate-500 text-sm mt-1">Cartons must not exceed 25 inches on any side or weigh more than 50 pounds.</p></div>
                            <div class="bg-white p-4 rounded-lg border border-slate-200"><p class="text-[#0d141c] text-base font-medium">Pallet Dimensions</p><p class="text-slate-500 text-sm mt-1">Use 40" x 48" pallets, not to exceed 72" in height or 1,500 lbs in weight.</p></div>
                            <div class="bg-white p-4 rounded-lg border border-slate-200"><p class="text-[#0d141c] text-base font-medium">Oversized Products</p><p class="text-slate-500 text-sm mt-1">An item is oversized if it is over 20 lbs or has any side longer than 18 inches.</p></div>
                        </div>
                    </div>
                    <div class="text-center"><button id="startBtn" class="flex mx-auto min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-[#0d80f2] text-slate-50 text-base font-bold"><span class="truncate">Start Estimating</span></button></div>
                </div>
            </div>
           
            <div id="calculatorPage" class="px-10 md:px-40 flex flex-1 justify-center py-5" style="display:none;">
                 <div class="layout-content-container flex flex-col w-full max-w-[960px] flex-1">
                    <h2 class="text-2xl font-bold text-center">Estimate Costs</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 text-left">
                        <div class="form-group"><label for="cbm" class="block text-sm font-medium text-gray-700">CBM (mÂ³)</label><input type="number" id="cbm" placeholder="e.g., 53" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></div>
                        <div class="form-group"><label for="cartonCount" class="block text-sm font-medium text-gray-700">Carton Count</label><input type="number" id="cartonCount" placeholder="e.g., 1200" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></div>
                        <div class="form-group"><label for="skuCount" class="block text-sm font-medium text-gray-700">SKU Count</label><input type="number" id="skuCount" placeholder="Optional" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></div>
                        <div class="form-group"><label for="loadType" class="block text-sm font-medium text-gray-700">Type of Load</label><select id="loadType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"><option value="" disabled selected>Select...</option><option value="Floor in/Floor out">Floor in/Floor out</option><option value="Palletized">Palletized</option></select></div>
                        <div class="form-group"><label for="location" class="block text-sm font-medium text-gray-700">Location</label><select id="location" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"><option value="" disabled selected>Select...</option><option value="LOS ANGELES">LOS ANGELES</option><option value="SAVANNAH">SAVANNAH</option><option value="NEW YORK">NEW YORK</option></select></div>
                        <div class="form-group"><label for="storage" class="block text-sm font-medium text-gray-700">Storage Required?</label><select id="storage" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"><option value="No" selected>No</option><option value="Yes">Yes</option></select></div>
                    </div>
                    <div class="flex gap-4 mt-8">
                        <button id="calculateBtn" class="flex-1 flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-[#0d80f2] text-slate-50 text-base font-bold"><span class="truncate">Calculate Estimates</span></button>
                        <button id="clearBtn" class="flex-1 flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-slate-600 text-slate-50 text-base font-bold"><span class="truncate">Clear</span></button>
                    </div>
                   
                    <div id="resultsPane" class="mt-10 p-6 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                            <div class="md:col-span-3"><h4 class="text-sm font-medium text-slate-500">Container Type</h4><p id="containerType" class="text-2xl font-bold text-[#0d80f2] mt-1">-</p></div>
                            <div class="result-item"><h4 class="text-sm font-medium text-slate-500">Pallet Count</h4><p id="palletCount" class="text-2xl font-bold text-[#0d80f2] mt-1">-</p></div>
                            <div class="result-item md:col-span-2"><h4 class="text-sm font-medium text-slate-500">All-in Rate</h4><p id="allInRate" class="text-2xl font-bold text-green-600 mt-1">$0.00</p></div>
                        </div>
                    </div>

                    <div class="mt-8 text-left text-xs text-slate-500 bg-slate-100 p-4 rounded-lg">
                        <p id="palletNote"> </p>
                    </div>
                 </div>
            </div>
        </div>
    </div>

<script>
    // --- Configuration ---
    const API_KEY = 'AIzaSyAgRYDlwfXHI0AWVOpY8OHHCd7aVgS4Bcc';
    const SPREADSHEET_ID = '1QrO4kP9ikY8Ukr8sxi6egOcPJkbaiGLvx7r4nuDn7cU';
    const PASSWORD = 'admin123';
    // ---------------------

    let pricingData = {};
    const elements = {
        appContainer: document.getElementById('app-container'),
        welcomePage: document.getElementById('welcomePage'),
        calculatorPage: document.getElementById('calculatorPage'),
        startBtn: document.getElementById('startBtn'),
        cbm: document.getElementById('cbm'),
        cartonCount: document.getElementById('cartonCount'),
        skuCount: document.getElementById('skuCount'),
        loadType: document.getElementById('loadType'),
        location: document.getElementById('location'),
        storage: document.getElementById('storage'),
        calculateBtn: document.getElementById('calculateBtn'),
        clearBtn: document.getElementById('clearBtn'),
        resultsPane: document.getElementById('resultsPane'),
        containerType: document.getElementById('containerType'),
        palletCount: document.getElementById('palletCount'),
        allInRate: document.getElementById('allInRate'),
        palletNote: document.getElementById('palletNote')
    };
   
    async function fetchAndParseData() {
        const sheetName = 'Admin_PricingData';
        const range = `${sheetName}!A1:J50`;
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Google Sheets API Error: ${(await response.json()).error.message}`);
            const data = await response.json();
            const sheetValues = data.values;
           
            pricingData = {};

            const cleanAndParse = (input, isFloat = true) => {
                if (input === null || input === undefined || input === "") return 0;
                const cleanedString = String(input).replace(/,/g, '').trim();
                const num = isFloat ? parseFloat(cleanedString) : parseInt(cleanedString, 10);
                return isNaN(num) ? 0 : num;
            };

            const getRowData = (arr) => ({
                basePrice: cleanAndParse(arr[1]),
                includedCartons: cleanAndParse(arr[2], false),
                includedSKUs: cleanAndParse(arr[3], false)
            });
           
            pricingData.locations = {
                'LOS ANGELES': {
                    '20GP': getRowData(sheetValues[2]), '40GP/HQ': getRowData(sheetValues[3]), '45HQ': getRowData(sheetValues[4])
                },
                'SAVANNAH': {
                    '20GP': getRowData(sheetValues[8]), '40GP/HQ': getRowData(sheetValues[9]), '45HQ': getRowData(sheetValues[10])
                },
                'NEW YORK': {
                    '20GP': getRowData(sheetValues[14]), '40GP/HQ': getRowData(sheetValues[15]), '45HQ': getRowData(sheetValues[16])
                }
            };

            pricingData.carrier = {};
            const carrierDataRows = sheetValues.slice(20, 23);
            carrierDataRows.forEach(row => {
                 if(row && row[0]) {
                    const locKey = String(row[0]).toUpperCase().trim();
                    pricingData.carrier[locKey] = {
                        carrier: row[1], drayRate: cleanAndParse(row[2]), chassisCost: cleanAndParse(row[3]),
                        standardChassisDays: cleanAndParse(row[4], false), freeChassisDays: cleanAndParse(row[5], false),
                        csrCommission: cleanAndParse(row[6])
                    };
                }
            });
           
            pricingData.charges = {};
            pricingData.values = {};
            const chargesDataRows = sheetValues.slice(2, 13);
            chargesDataRows.forEach(row => {
                if (row && row[8]) pricingData.charges[String(row[8]).trim()] = cleanAndParse(row[9]);
            });
            const limitsDataRows = sheetValues.slice(16, 28);
            limitsDataRows.forEach(row => {
                if (row && row[8]) {
                    const key = String(row[8]).trim();
                    const value = String(row[9] || '').trim();
                    if (key) {
                        if (key === 'Container Threshold CBM (40GP/HQ)') {
                            const parts = value.split('-');
                            pricingData.values[key] = { min: cleanAndParse(parts[0]), max: cleanAndParse(parts[1]) };
                        } else {
                            pricingData.values[key] = value.includes('>') ? cleanAndParse(value.replace('>', '')) : cleanAndParse(value);
                        }
                    }
                }
            });

            const opCBM = pricingData.values['CBM per Pallet (Operations)'];
            const whCBM = pricingData.values['CBM per Pallet (Warehouse)'];
            elements.palletNote.innerHTML = `<strong>Note:</strong> Pallet count ranges are estimated using an Operations value of ${opCBM} and Warehouse value of ${whCBM} CBM/pallet.`;

        } catch (error) {
            alert(`A critical error occurred while loading data from the sheet. The sheet structure may be incorrect. Please check the Developer Console (F12).`);
            console.error("Data Loading Error:", error);
        }
    }

    function calculateEstimate() {
        try {
            const cbm = parseFloat(elements.cbm.value);
            const cartonCount = parseInt(elements.cartonCount.value);
            let skuCount = parseInt(elements.skuCount.value);
            const loadType = elements.loadType.value;
            const locationInput = elements.location.value;
            const storage = elements.storage.value;

            if (isNaN(cbm) || cbm <= 0 || isNaN(cartonCount) || cartonCount <= 0) { alert('Please enter valid numbers for CBM and Carton Count.'); return; }
            if (!loadType || !locationInput) { alert('Please select a Type of Load and a Location.'); return; }

            const th20GP = pricingData.values['Container Threshold CBM (20GP)'];
            const th40GP = pricingData.values['Container Threshold CBM (40GP/HQ)'];
           
            let containerType;
            if (cbm <= th20GP) {
                containerType = '20GP';
            } else if (cbm >= th40GP.min && cbm <= th40GP.max) {
                containerType = '40GP/HQ';
            } else {
                containerType = '45HQ';
            }
           
            const basePricing = pricingData.locations[locationInput][containerType];
            if (!basePricing) { alert(`Error: Could not find base pricing for "${locationInput}" and container "${containerType}".`); return; }

            if (isNaN(skuCount) || skuCount <= 0) { skuCount = basePricing.includedSKUs; }
           
            const cartonSurchargeKey = loadType === 'Palletized' ? 'Carton Surcharge (Floor in/Pallet out)' : 'Carton Surcharge (Floor in/Floor out)';
            const skuSurchargeKey = 'Sort Surcharge (Floor in/Pallet out)';

            let cartonSurcharge = (cartonCount > basePricing.includedCartons) ? (cartonCount - basePricing.includedCartons) * (pricingData.charges[cartonSurchargeKey] || 0) : 0;
            let skuSurcharge = (skuCount > basePricing.includedSKUs) ? (skuCount - basePricing.includedSKUs) * (pricingData.charges[skuSurchargeKey] || 0) : 0;
           
            const carrierCosts = pricingData.carrier[locationInput];
            if (!carrierCosts) { alert(`Error: Could not find carrier pricing for "${locationInput}".`); return; }

            let actualChassisCost = (carrierCosts.standardChassisDays > carrierCosts.freeChassisDays) ? carrierCosts.chassisCost : 0;
            const totalCarrierCost = carrierCosts.drayRate + actualChassisCost + carrierCosts.csrCommission;
           
            const storageFee = (storage === 'Yes') ? (cbm * (pricingData.charges['Storage CBM/Day (All)'] || 0)) : 0;
            const commonCosts = basePricing.basePrice + cartonSurcharge + skuSurcharge + totalCarrierCost + storageFee;
           
            elements.containerType.textContent = containerType;

            if (loadType === 'Palletized') {
                const opCBM = pricingData.values['CBM per Pallet (Operations)'];
                const whCBM = pricingData.values['CBM per Pallet (Warehouse)'];
                const opPallets = Math.ceil(cbm / opCBM);
                const whPallets = Math.ceil(cbm / whCBM);
                const outboundSurchargeRate = pricingData.charges['Outbound Pallet Surcharge (Floor in/Pallet out)'] || 0;
                const opSurcharge = opPallets * outboundSurchargeRate;
                const whSurcharge = whPallets * outboundSurchargeRate;
                const lowEndRate = commonCosts + opSurcharge;
                const highEndRate = commonCosts + whSurcharge;
                elements.palletCount.innerHTML = `<span class="range">${opPallets} - ${whPallets}</span>`;
                elements.allInRate.innerHTML = `<span class="range">${lowEndRate.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} - ${highEndRate.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</span>`;
            } else { // Floor in/Floor out
                elements.palletCount.textContent = '-';
                elements.allInRate.textContent = commonCosts.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }
           
            elements.resultsPane.classList.add('visible');
        } catch (error) {
            alert("A calculation error occurred. This is often due to missing or incorrect data in the Google Sheet. Please check the Developer Console (F12) for details.");
            console.error("Calculation Error:", error);
        }
    }

    function clearForm() {
        elements.cbm.value = '';
        elements.cartonCount.value = '';
        elements.skuCount.value = '';
        elements.loadType.value = '';
        elements.location.value = '';
        elements.storage.value = 'No';
        elements.resultsPane.classList.remove('visible');
        elements.cbm.focus();
    }
   
    function initialize() {
        const userPassword = prompt("Please enter the password to access the calculator:", "");
        if (userPassword === PASSWORD) {
            elements.appContainer.style.display = 'flex';
            fetchAndParseData();
        } else {
            alert("Incorrect password. Access denied.");
        }

        elements.startBtn.addEventListener('click', () => {
            elements.welcomePage.style.display = 'none';
            elements.calculatorPage.style.display = 'flex';
            elements.resultsPane.style.display = 'none';
        });

        elements.calculateBtn.addEventListener('click', calculateEstimate);
        elements.clearBtn.addEventListener('click', clearForm);

        // 'Enter' key navigation
        const inputs = [elements.cbm, elements.cartonCount, elements.skuCount];
        inputs.forEach((input, index) => {
            input.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const nextInput = inputs[index + 1];
                    if (nextInput) {
                        nextInput.focus();
                    } else {
                        elements.loadType.focus();
                    }
                }
            });
        });
    }
   
    initialize();
</script>
</body>
</html>
