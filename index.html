<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B600%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />
    <title>FBA Shipment Cost Estimator</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
        body {
            background-color: #f8fafc; /* Use a light gray background */
        }
        #app-container {
            display: none; /* Hidden until password is confirmed */
        }
        #startBtn {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        #startBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px -5px rgba(13, 128, 242, 0.4);
        }
        #resultsPane {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            opacity: 0;
            transform: translateY(15px);
        }
        #resultsPane.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .storage-btn {
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            background-color: white;
            color: #374151;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        .storage-btn.active {
            background-color: #0d80f2;
            color: white;
            border-color: #0d80f2;
        }
        .range-text {
            font-size: 1.25rem; /* Slightly smaller for ranges */
        }
        .icon-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            border-radius: 9999px; /* A large value to make it a circle */
            background-color: #e0f2fe; /* Light blue background */
            color: #0d80f2; /* Icon color */
        }
    </style>
</head>

<body>
    <div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
        <div id="app-container" class="layout-container flex h-full grow flex-col">
            <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-slate-200 bg-white px-10 py-3">
                <div class="flex items-center gap-4 text-slate-800">
                    <div class="size-4 text-[#0d80f2]">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_6_330)"><path fill-rule="evenodd" clip-rule="evenodd" d="M24 0.757355L47.2426 24L24 47.2426L0.757355 24L24 0.757355ZM21 35.7574V12.2426L9.24264 24L21 35.7574Z" fill="currentColor"></path></g><defs><clipPath id="clip0_6_330"><rect width="48" height="48" fill="white"></rect></clipPath></defs></svg>
                    </div>
                    <h2 class="text-lg font-bold tracking-[-0.015em]">Shipment Estimator</h2>
                </div>
            </header>

            <div id="welcomePage" class="flex flex-1 justify-center py-10 px-4 bg-slate-50">
                <div class="layout-content-container flex flex-col w-full max-w-5xl flex-1 text-center">

                    <div class="bg-[#004d99] text-white rounded-xl shadow-2xl p-10 md:p-16">
                        <h1 class="text-4xl md:text-5xl font-black tracking-tight">FBA Shipment Cost Estimator</h1>
                        <p class="text-lg text-blue-200 mt-2">(Excludes Last Mile Carrier Rates)</p>
                        <div class="mt-8">
                            <button id="startBtn" class="flex mx-auto min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-8 bg-[#0d80f2] text-slate-50 text-base font-bold shadow-md">
                                <span class="truncate">Start Estimating</span>
                            </button>
                        </div>
                    </div>

                    <div class="my-10">
                        <h3 class="text-xl font-bold text-slate-700 mb-6">Key Amazon FBA Guidelines</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                            <div class="bg-white p-5 rounded-lg shadow-sm border border-slate-200 flex items-start gap-4">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,32l80.34,44-29.77,16.3-80.35-44ZM40,90.15l88,48.17v85.25L40,175.4Z"></path></svg>
                                </div>
                                <div>
                                    <p class="text-slate-800 text-base font-bold">Carton Limits</p>
                                    <p class="text-slate-500 text-sm mt-1">Cartons must not exceed 25" on any side or weigh more than 50 lbs.</p>
                                </div>
                            </div>
                            <div class="bg-white p-5 rounded-lg shadow-sm border border-slate-200 flex items-start gap-4">
                                <div class="icon-container">
                                   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M240,128v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V128a16,16,0,0,1,16-16H224A16,16,0,0,1,240,128Zm-16,0H32v64H224ZM96,64V48a16,16,0,0,0-16-16H48A16,16,0,0,0,32,48V64a8,8,0,0,0,16,0V48H80V64a8,8,0,0,0,16,0Zm128,0V48a16,16,0,0,0-16-16H176a16,16,0,0,0-16,16V64a8,8,0,0,0,16,0V48h16V64a8,8,0,0,0,16,0Z"></path></svg>
                                </div>
                                <div>
                                    <p class="text-slate-800 text-base font-bold">Pallet Dimensions</p>
                                    <p class="text-slate-500 text-sm mt-1">Use 40" x 48" pallets, not to exceed 72" in height or 1,500 lbs in weight.</p>
                                </div>
                            </div>
                            <div class="bg-white p-5 rounded-lg shadow-sm border border-slate-200 flex items-start gap-4">
                                <div class="icon-container">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M184,184a32,32,0,1,1-32-32A32,32,0,0,1,184,184ZM128,80a32,32,0,1,0-32-32A32,32,0,0,0,128,80Zm-32,72a32,32,0,1,0,32,32A32,32,0,0,0,96,152ZM160,80a32,32,0,1,0,32-32A32,32,0,0,0,160,80Z"></path></svg>
                                </div>
                                <div>
                                    <p class="text-slate-800 text-base font-bold">Oversized Products</p>
                                    <p class="text-slate-500 text-sm mt-1">A single item is oversized if it is over 20 lbs or has any side longer than 18".</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="calculatorPage" class="flex flex-1 justify-center py-5 px-10" style="display:none;">
                <div class="layout-content-container flex flex-col w-full max-w-4xl flex-1">
                    <h2 class="text-2xl font-bold text-center text-slate-700">Estimate Your Costs</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 text-left bg-white p-8 rounded-lg shadow-md border border-slate-200">
                        <div class="form-group"><label for="cbm" class="block text-sm font-medium text-gray-700">CBM (mÂ³)</label><input type="number" id="cbm" placeholder="e.g., 53" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></div>
                        <div class="form-group"><label for="cartonCount" class="block text-sm font-medium text-gray-700">Carton Count</label><input type="number" id="cartonCount" placeholder="e.g., 1200" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></div>
                        <div class="form-group"><label for="skuCount" class="block text-sm font-medium text-gray-700">SKU Count</label><input type="number" id="skuCount" placeholder="Optional" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></div>
                        <div class="form-group"><label for="loadType" class="block text-sm font-medium text-gray-700">Type of Load</label><select id="loadType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"><option value="" disabled selected>Select...</option><option value="Floor in/Floor out">Floor in/Floor out</option><option value="Palletized">Palletized</option></select></div>
                        <div class="form-group"><label for="location" class="block text-sm font-medium text-gray-700">Location</label><select id="location" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"><option value="" disabled selected>Select...</option><option value="LOS ANGELES">Los Angeles</option><option value="SAVANNAH">Savannah</option><option value="NEW YORK">New York</option></select></div>
                        <div class="form-group"><label class="block text-sm font-medium text-gray-700">Storage Required?</label><div id="storage" class="flex mt-1"><button class="storage-btn" data-value="Yes">Yes</button><button class="storage-btn active" data-value="No">No</button></div></div>
                    </div>
                    <div class="flex gap-4 mt-8">
                        <button id="calculateBtn" class="flex-1 flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-[#0d80f2] text-slate-50 text-base font-bold shadow-md hover:bg-blue-700 transition-colors"><span class="truncate">Calculate</span></button>
                        <button id="clearBtn" class="flex-1 flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-slate-600 text-slate-50 text-base font-bold shadow-md hover:bg-slate-700 transition-colors"><span class="truncate">Clear</span></button>
                    </div>
                   
                    <div id="resultsPane" class="mt-10 p-6 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-6 text-center">
                            <div><h4 class="text-sm font-medium text-slate-500">Container Type</h4><p id="containerType" class="text-2xl font-bold text-[#0d80f2] mt-1">-</p></div>
                            <div><h4 class="text-sm font-medium text-slate-500">Pallet Count</h4><p id="palletCount" class="text-2xl font-bold text-[#0d80f2] mt-1">-</p></div>
                            <div class="col-span-2 md:col-span-1"><h4 class="text-sm font-medium text-slate-500">All-in Rate</h4><p id="allInRate" class="text-2xl font-bold text-green-600 mt-1">$0.00</p></div>
                        </div>
                    </div>

                    <div class="mt-8 text-sm text-slate-600 bg-slate-100 p-6 rounded-lg space-y-3">
                        <p><strong>Rate Includes:</strong> The base service fee, drayage transport, and CSR commission. Surcharges for extra cartons/SKUs and optional storage are added as needed.</p>
                        <p><strong>Palletized Range:</strong> A cost range is shown for palletized loads because the final pallet count can vary. The lower cost assumes a dense "Operations" pack-out, while the higher cost assumes a standard "Warehouse" pack-out.</p>
                        <p id="labelingNote"><strong>Labeling Costs:</strong> For optional FNSKU labeling, please refer to your specific rate card or contact us for a quote.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const API_KEY = 'AIzaSyAgRYDlwfXHI0AWVOpY8OHHCd7aVgS4Bcc';
        const SPREADSHEET_ID = '1QrO4kP9ikY8Ukr8sxi6egOcPJkbaiGLvx7r4nuDn7cU';
        const PASSWORD = 'admin123';
        // ---------------------

        let pricingData = {};
        const elements = {
            appContainer: document.getElementById('app-container'),
            welcomePage: document.getElementById('welcomePage'),
            calculatorPage: document.getElementById('calculatorPage'),
            startBtn: document.getElementById('startBtn'),
            cbm: document.getElementById('cbm'),
            cartonCount: document.getElementById('cartonCount'),
            skuCount: document.getElementById('skuCount'),
            loadType: document.getElementById('loadType'),
            location: document.getElementById('location'),
            storage: document.getElementById('storage'),
            calculateBtn: document.getElementById('calculateBtn'),
            clearBtn: document.getElementById('clearBtn'),
            resultsPane: document.getElementById('resultsPane'),
            containerType: document.getElementById('containerType'),
            palletCount: document.getElementById('palletCount'),
            allInRate: document.getElementById('allInRate'),
            labelingNote: document.getElementById('labelingNote')
        };

        function parseSheetData(values) {
            const data = { locations: {}, carrier: {}, rates: {}, constants: {} };
            const cleanAndParse = (input, isFloat = true) => {
                if (input === undefined || input === null || input === '') return 0;
                const cleanedString = String(input).replace(/[\$,]/g, '');
                const number = isFloat ? parseFloat(cleanedString) : parseInt(cleanedString, 10);
                return isNaN(number) ? 0 : number;
            };
            const findHeaderRow = (headerText) => values.findIndex(row => row && row[0] && row[0].trim().toUpperCase() === headerText.toUpperCase());

            // Location Pricing
            const locationHeaders = ["LOS ANGELES PRICING", "SAVANNAH PRICING", "NEW YORK PRICING"];
            locationHeaders.forEach(header => {
                const startRow = findHeaderRow(header);
                if (startRow !== -1) {
                    const locationKey = header.replace(" PRICING", "");
                    data.locations[locationKey] = {};
                    for (let i = startRow + 2; i < startRow + 5; i++) {
                        const row = values[i];
                        if (row && row[0]) {
                            const normalizedKey = row[0].trim().toUpperCase().replace(/[^A-Z0-9]/g, '');
                            data.locations[locationKey][normalizedKey] = {
                                basePrice: cleanAndParse(row[1]),
                                includedCartons: cleanAndParse(row[2], false),
                                includedSkus: cleanAndParse(row[3], false),
                                displayName: row[0].trim()
                            };
                        }
                    }
                }
            });

            // Carrier Pricing
            const carrierStartRow = findHeaderRow("CARRIER PRICING");
            if (carrierStartRow !== -1) {
                for (let i = carrierStartRow + 2; i < carrierStartRow + 5; i++) {
                    const row = values[i];
                    if (row && row[0]) {
                        data.carrier[row[0].toUpperCase()] = {
                            drayRate: cleanAndParse(row[2]),
                            chassisCost: cleanAndParse(row[3]),
                            standardChassisDays: cleanAndParse(row[4], false),
                            freeChassisDays: cleanAndParse(row[5], false),
                            csrCommission: cleanAndParse(row[6])
                        };
                    }
                }
            }

            // Rates, Constants, and Labeling Fees
            values.forEach(row => {
                if (!row || !row[8]) return;
                const key = row[8].trim();
                const value = cleanAndParse(row[9]);
                if (key.toLowerCase().includes('labeling')) {
                    data.rates[key] = value;
                } else if (key.toLowerCase().includes('surcharge') || key.toLowerCase().includes('storage')) {
                    data.rates[key] = value;
                } else {
                    data.constants[key] = value;
                }
            });
            return data;
        }

        async function fetchAndParseData() {
            const sheetName = 'Admin_PricingData';
            const range = `${sheetName}!A1:J50`;
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Google Sheets API Error: ${errorData.error.message}`);
                }
                const rawData = await response.json();
                pricingData = parseSheetData(rawData.values);
               
                // Dynamically update the labeling note
                const regLabel = (pricingData.rates['Labeling (Regular label, All)'] || 0).toLocaleString('en-US', {style:'currency', currency:'USD'});
                elements.labelingNote.innerHTML = `<strong>Labeling Costs:</strong> Optional FNSKU labeling is available. The standard rate is ${regLabel} per label. Please contact us for other labeling needs.`;
               
            } catch (error) {
                alert(`Fatal Error: Could not load pricing data. ${error.message}. Please check API Key and Sheet settings, then refresh.`);
                console.error(error);
            }
        }

        function calculateEstimate() {
            const cbm = parseFloat(elements.cbm.value);
            const cartonCount = parseInt(elements.cartonCount.value);
            let skuCount = parseInt(elements.skuCount.value);
            if (isNaN(skuCount) || skuCount <= 0) skuCount = 1;
           
            const loadType = elements.loadType.value;
            const location = elements.location.value;
            const storageRequired = elements.storage.querySelector('.active').dataset.value === 'Yes';
           
            if (isNaN(cbm) || cbm <= 0 || isNaN(cartonCount) || cartonCount <= 0) { alert('Please enter valid, positive numbers for CBM and Carton Count.'); return; }
            if (!loadType || !location) { alert('Please select a Type of Load and a Location.'); return; }

            let containerKey;
            if (cbm <= 32) containerKey = '20GP';
            else if (cbm >= 33 && cbm <= 65) containerKey = '40GPHQ';
            else containerKey = '45HQ';

            const corePricing = pricingData.locations[location]?.[containerKey];
            if (!corePricing) { alert(`Error: Could not find pricing for ${location} and container ${containerKey}.`); return; }
           
            const carrierInfo = pricingData.carrier[location];
            if (!carrierInfo) { alert(`Error: Could not find carrier info for ${location}.`); return; }

            if (loadType === 'Floor in/Floor out') calculateFloorLoad(cbm, cartonCount, skuCount, storageRequired, corePricing, carrierInfo);
            else if (loadType === 'Palletized') calculatePalletizedLoad(cbm, cartonCount, skuCount, storageRequired, corePricing, carrierInfo);

            elements.resultsPane.classList.add('visible');
        }

        function calculateFloorLoad(cbm, cartonCount, skuCount, storageRequired, corePricing, carrierInfo) {
            const cartonSurcharge = Math.max(0, cartonCount - corePricing.includedCartons) * (pricingData.rates['Carton Surcharge (Floor in/Pallet out)'] || 0);
            const skuSurcharge = Math.max(0, skuCount - corePricing.includedSkus) * (pricingData.rates['Sort Surcharge (Floor in/Floor out)'] || 0);
            const chassisCost = (carrierInfo.standardChassisDays > carrierInfo.freeChassisDays) ? carrierInfo.chassisCost : 0;
            const totalCarrierCost = carrierInfo.drayRate + carrierInfo.csrCommission + chassisCost;
            const storageFee = storageRequired ? cbm * (pricingData.rates['Storage CBM/Day (All)'] || 0) : 0;
            const allInRate = corePricing.basePrice + cartonSurcharge + skuSurcharge + totalCarrierCost + storageFee;
           
            elements.containerType.textContent = corePricing.displayName;
            elements.palletCount.textContent = "-";
            elements.allInRate.textContent = allInRate.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        }
       
        function calculatePalletizedLoad(cbm, cartonCount, skuCount, storageRequired, corePricing, carrierInfo) {
            const opsPallets = Math.ceil(cbm / (pricingData.constants['CBM per Pallet (Operations)'] || 2.20));
            const warehousePallets = Math.ceil(cbm / (pricingData.constants['CBM per Pallet (Warehouse)'] || 1.70));
           
            const cartonSurcharge = Math.max(0, cartonCount - corePricing.includedCartons) * (pricingData.rates['Carton Surcharge (Floor in/Pallet out)'] || 0);
            const skuSurcharge = Math.max(0, skuCount - corePricing.includedSkus) * (pricingData.rates['Sort Surcharge (Floor in/Pallet out)'] || 0);
            const chassisCost = (carrierInfo.standardChassisDays > carrierInfo.freeChassisDays) ? carrierInfo.chassisCost : 0;
            const totalCarrierCost = carrierInfo.drayRate + carrierInfo.csrCommission + chassisCost;
            const storageFee = storageRequired ? cbm * (pricingData.rates['Storage CBM/Day (All)'] || 0) : 0;
            const commonCosts = corePricing.basePrice + cartonSurcharge + skuSurcharge + totalCarrierCost + storageFee;
            const outboundPalletRate = pricingData.rates['Outbound Pallet Surcharge (Floor in/Pallet out)'] || 0;
           
            const lowEndRate = commonCosts + (opsPallets * outboundPalletRate);
            const highEndRate = commonCosts + (warehousePallets * outboundPalletRate);

            elements.containerType.textContent = corePricing.displayName;
            elements.palletCount.innerHTML = `<span class="range-text">${opsPallets} - ${warehousePallets}</span>`;
            elements.allInRate.innerHTML = `<span class="range-text">${lowEndRate.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} - ${highEndRate.toLocaleString('en-US', { style: 'currency', 'currency': 'USD' })}</span>`;
        }

        function clearForm() {
            elements.cbm.value = '';
            elements.cartonCount.value = '';
            elements.skuCount.value = '';
            elements.loadType.value = '';
            elements.location.value = '';
            elements.resultsPane.classList.remove('visible');
            elements.storage.querySelector('[data-value="Yes"]').classList.remove('active');
            elements.storage.querySelector('[data-value="No"]').classList.add('active');
            elements.cbm.focus();
        }

        function setupEventListeners() {
            elements.startBtn.addEventListener('click', () => {
                elements.welcomePage.style.display = 'none';
                elements.calculatorPage.style.display = 'flex';
                elements.cbm.focus();
            });

            elements.storage.addEventListener('click', (event) => {
                if (event.target.tagName === 'BUTTON') {
                    elements.storage.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    event.target.classList.add('active');
                }
            });

            elements.calculateBtn.addEventListener('click', calculateEstimate);
            elements.clearBtn.addEventListener('click', clearForm);

            // "Enter" key navigation
            const inputs = [elements.cbm, elements.cartonCount, elements.skuCount, elements.loadType];
            inputs.forEach((input, index) => {
                input.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        const nextInput = inputs[index + 1];
                        if (nextInput) {
                            nextInput.focus();
                        } else {
                            elements.location.focus(); // Special case for last input
                        }
                    }
                });
            });
        }

        function initialize() {
            const userPassword = prompt("Please enter the password to access:", "");
            if (userPassword === PASSWORD) {
                elements.appContainer.style.display = 'flex';
                fetchAndParseData();
                setupEventListeners();
            } else {
                document.body.innerHTML = `<div class="w-full h-screen flex items-center justify-center"><h1 class="text-red-500 text-center text-2xl p-8">Access Denied</h1></div>`;
            }
        }

        initialize();
    </script>
</body>
</html>

